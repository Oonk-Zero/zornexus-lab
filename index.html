<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <title>Zornexus STEP 3 ‚Üí STEP 4 Lab</title>

  <style>
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      padding: 24px;
      max-width: 960px;
      margin: auto;
      background: #fafafa;
    }

    h2 {
      margin-top: 32px;
    }

    textarea {
      width: 100%;
      min-height: 240px;
      margin-bottom: 12px;
      font-family: monospace;
      font-size: 14px;
      padding: 12px;
      border-radius: 6px;
      border: 1px solid #ccc;
      box-sizing: border-box;
      background: #fff;
    }

    button {
      padding: 12px 20px;
      font-size: 16px;
      cursor: pointer;
      border-radius: 6px;
      border: none;
      background: #111;
      color: #fff;
    }

    button:disabled {
      opacity: 0.6;
      cursor: not-allowed;
    }

    .status {
      margin-top: 12px;
      font-size: 14px;
      color: #555;
    }

    .error {
      color: #c0392b;
    }
  </style>

  <!-- ‚úÖ ClickRank Ownership Verification -->
  <script>
    (function () {
      var clickRankAi = document.createElement("script");
      clickRankAi.src =
        "https://js.clickrank.ai/seo/2f65a8aa-3f9c-4e88-a97c-a82f81030b08/script?t=" +
        Date.now();
      clickRankAi.async = true;
      document.head.appendChild(clickRankAi);
    })();
  </script>
</head>

<body>

  <h1>Zornexus ¬∑ STEP 3 ‚Üí STEP 4 (Typhoon)</h1>

  <h2>STEP 3 YAML</h2>
  <textarea
    id="input"
    placeholder="‡∏ß‡∏≤‡∏á STEP 3 YAML ‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ..."
  ></textarea>

  <button id="runBtn" onclick="runStep4()">Finalize ‚Üí STEP 4</button>

  <div id="status" class="status"></div>

  <h2>STEP 4 YAML (Final Script)</h2>
  <textarea
    id="output"
    placeholder="‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏à‡∏≤‡∏Å Typhoon ‡∏à‡∏∞‡∏Ç‡∏∂‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà..."
  ></textarea>

  <script>
    // üîß ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô URL ‡∏ô‡∏µ‡πâ‡πÄ‡∏õ‡πá‡∏ô Production Webhook URL ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì
    const N8N_WEBHOOK_URL = "http://localhost:5678/webhook/zornexus/step4";

    async function runStep4() {
      const inputEl = document.getElementById("input");
      const outputEl = document.getElementById("output");
      const statusEl = document.getElementById("status");
      const button = document.getElementById("runBtn");

      const step3Yaml = inputEl.value.trim();

      if (!step3Yaml) {
        statusEl.textContent = "‚ö†Ô∏è ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ß‡∏≤‡∏á STEP 3 YAML ‡∏Å‡πà‡∏≠‡∏ô";
        statusEl.className = "status error";
        return;
      }

      statusEl.textContent = "‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡πà‡∏á‡πÑ‡∏õ Typhoon...";
      statusEl.className = "status";
      outputEl.value = "";
      button.disabled = true;

      try {
        const response = await fetch(N8N_WEBHOOK_URL, {
          method: "POST",
          headers: {
            "Content-Type": "application/json"
          },
          body: JSON.stringify({
            step3_yaml: step3Yaml
          })
        });

        if (!response.ok) {
          throw new Error("HTTP " + response.status);
        }

        const data = await response.json();

        // ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡πÑ‡∏î‡πâ‡∏´‡∏•‡∏≤‡∏¢ shape
        const step4Yaml =
          data.step4_yaml ||
          (data.data && data.data.step4_yaml) ||
          "";

        if (!step4Yaml) {
          throw new Error("‡πÑ‡∏°‡πà‡∏û‡∏ö step4_yaml ‡πÉ‡∏ô response");
        }

        outputEl.value = step4Yaml;
        statusEl.textContent = "‚úÖ ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! ‡πÑ‡∏î‡πâ STEP 4 Script ‡πÅ‡∏•‡πâ‡∏ß";
        statusEl.className = "status";

      } catch (err) {
        console.error(err);
        statusEl.textContent =
          "‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: " + err.message;
        statusEl.className = "status error";
      } finally {
        button.disabled = false;
      }
    }
  </script>

</body>
</html>
